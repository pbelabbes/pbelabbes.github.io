<!DOCTYPE html>
<html lang="">
<!-- head --><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1"> 
    <!-- stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"> 
    <link rel="stylesheet" href="/assets/main.css">
    <!-- <link rel="stylesheet" href="/assets/richleland-pygments-css/vs.css"> --> 
    <!-- jekyll-seo-tag -->
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Custom initialization overview | Bonitasoft Documentation Prototype</title>
<meta name="generator" content="Jekyll v3.8.2" />
<meta property="og:title" content="Custom initialization overview" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bonita Container Custom Initialization" />
<meta property="og:description" content="Bonita Container Custom Initialization" />
<link rel="canonical" href="http://localhost:4000/bcd/1.0/tutorials/bonita-container-custom-initialization/custom_init" />
<meta property="og:url" content="http://localhost:4000/bcd/1.0/tutorials/bonita-container-custom-initialization/custom_init" />
<meta property="og:site_name" content="Bonitasoft Documentation Prototype" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-21T17:08:37+02:00" />
<script type="application/ld+json">
{"description":"Bonita Container Custom Initialization","@type":"BlogPosting","url":"http://localhost:4000/bcd/1.0/tutorials/bonita-container-custom-initialization/custom_init","headline":"Custom initialization overview","dateModified":"2018-06-21T17:08:37+02:00","datePublished":"2018-06-21T17:08:37+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/bcd/1.0/tutorials/bonita-container-custom-initialization/custom_init"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- favicons and rss -->
    <link rel="alternate" type="application/rss+xml" title="Bonitasoft Documentation Prototype" href="/feed.xml">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/bonita-32_0.png">
</head>
<body>
    <!-- header --><div class="documentationHeader">
    <nav class="navbar navbar-default">
      <div id="top-links" class="container-fluid">
          <div class="row">
             <ul class="inline pull-right">
                 <li><a href="http://www.bonitasoft.com/about-us/news" style="color: white">News</a></li>
                 <li><a href="http://community.bonitasoft.com/" style="color: white">Community</a></li>
                 <li><a href="http://customer.bonitasoft.com/" style="color: white">Customer portal</a></li>
                 <li><a href="http://partner.bonitasoft.com/home" style="color: white">Partners</a></li>
             </ul>
          </div>
      </div>
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="logo">
            <img alt="Bonitasoft" src="/assets/img/logo_white.png">
          </a>
        </div>
        <ul class="nav navbar-nav">
          <li class="dropdown" >
            <a class="version" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Bonita <span class="caret"></span></a>
            <ul class="dropdown-menu">
                
                
                <li role="menuitem">
                        <a class="version" href="http://localhost:4000/bonita/7.7">7.7 </a>
                </li>
      
                
                <li role="menuitem">
                        <a class="version" href="http://localhost:4000/bonita/7.6">7.6 </a>
                </li>
      
                
                <li role="menuitem">
                        <a class="version" href="http://localhost:4000/bonita/7.5">7.5 </a>
                </li>
      
                
                
                <!-- <li class="menu-item dropdown dropdown-submenu">
                    <a class="dropdown-toggle">Other versions</a>
                    <ul class="dropdown-menu">
                        <li >
                            <a href="" class="version"></a>
                        </li>
                    </ul>
                </li> -->
  
            </ul>
          </li>
          <li class="dropdown">
          <a class="version" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Add-ons <span class="caret"></span></a>
          <ul class="dropdown-menu" >

              
              
                
                    <li class="menu-item dropdown dropdown-submenu" >
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">bcd</a>
                        <ul class="dropdown-menu">
                            
                                <li class="addOnVersion" >
                                    <a class="version" href="http://localhost:4000/bcd/2.0">2.0</a>
                                </li>
                            
                                <li class="addOnVersion" >
                                    <a class="version" href="http://localhost:4000/bcd/1.0">1.0</a>
                                </li>
                            
                            
                        </ul>
                    </li>
                
                
               
              
               
              
                
                    <li class="menu-item dropdown dropdown-submenu" >
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ici</a>
                        <ul class="dropdown-menu">
                            
                                <li class="addOnVersion" >
                                    <a class="version" href="http://localhost:4000/ici/1.0">1.0</a>
                                </li>
                            
                            
                        </ul>
                    </li>
                
                
               
              
                
                
               
              
          </ul>
          </li>
        </ul>
      </div>
    </nav>
  </div><div class="container-fluid">
        <div class="row">
            <div class="col-md-3"><div id="navigationHeader" class="documentationNavigationHeader">
    <h2><a href="http://localhost:4000/bcd/1.0">
            
            <img src="/assets/img/logo_bcd.png" />
            
                

                <span>Bcd  1.0</span>
        </a>
    </h2>
    <form class="searchBox" role="search">
        <div class="input-group">
            <input type="text" class="form-control" placeholder="Search">
            <span class="input-group-addon">
                <span class="glyphicon glyphicon-search"></span>
            </span>
        </div>
    </form>
</div>

<div class="documentationNavigation">
  
    <!-- Create an array to store the current category --><!-- Start iterate in categories  -->
    <ul><!-- create an array with all categories corresponding to a node in the taxonomy  --><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/release_notes">Release notes</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li><a role="button" data-toggle="collapse"  href="#tutorials" aria-controls="tutorials"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span><strong>Tutorials</strong></a><ul id="tutorials" class="collapse"><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/aws_prerequisites">AWS prerequisites</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/licensing_prerequisites">Licensing prerequisites</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/quickstart">Quick start</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li><a role="button" data-toggle="collapse"  href="#bonita-container-custom-initialization" aria-controls="bonita-container-custom-initialization"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span><strong>Bonita container custom initialization</strong></a><ul id="bonita-container-custom-initialization" class="collapse"><li class="active" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/bonita-container-custom-initialization/custom_init">Custom initialization overview</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/bonita-container-custom-initialization/how_to_configure_rest_api_authorization">How to configure REST API authorization</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --></ul></li><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/tutorials/troubleshooting_guide">Troubleshooting guide</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --></ul></li><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/scenarios">Scenario variables reference</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li><a role="button" data-toggle="collapse"  href="#bcd-controller-docker-image" aria-controls="bcd-controller-docker-image"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span><strong>BCD Controller Docker image</strong></a><ul id="bcd-controller-docker-image" class="collapse"><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/bcd-controller-docker-image/docker">Docker image overview</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --><li class="" ><i class="fa fa-circle-o" aria-hidden="true"></i> <a href="/bcd/1.0/bcd-controller-docker-image/cli">BCD Command Line Interface</a></li><!-- create an array with all categories corresponding to a node in the taxonomy  --></ul></li></ul>
</div></div>
            <div class="col-md-9 content--noPaddingRight" >
                <div class="documentationContent">
                    <div class="documentationPage">
                            <a href="https://github.com/bonitasoft/bonita-continuous-delivery-doc/edit/1.0/md/custom_init.md" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
                        <h1 id="bonita-container-custom-initialization">Bonita Container Custom Initialization</h1>

<p>The Bonita Docker container deployed by BCD can be further customized thanks to a custom initialization mechanism.</p>

<p>This feature relies on the ability to extend the <a href="https://hub.docker.com/_/bonita/">Bonita Docker image</a> through custom <code class="highlighter-rouge">*.sh</code> shell scripts.</p>

<h2 id="where-should-i-put-custom-initialization-scripts">Where should I put custom initialization scripts?</h2>

<p>Custom initialization files can be <strong>static</strong> or they can be <strong>dynamic</strong> while relying on runtime variables. Dynamic initialization files then leverage the <a href="http://docs.ansible.com/ansible/latest/playbooks_templating.html">Jinja2 templating framework used by Ansible</a>.</p>

<h3 id="static-initialization-files">Static initialization files</h3>

<p>Static custom initialization files must be placed in BCD’s <code class="highlighter-rouge">roles/bonita/files/custom-init.d</code> folder. All files from this folder will be uploaded to the target host regardless their extension. However only the files with a <code class="highlighter-rouge">.sh</code> extension will be executed.</p>

<p>Here’s the directory layout for a <code class="highlighter-rouge">register-event-handler.sh</code> custom script:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roles
├── bonita
│   ├── files
│   │   ├── custom-init.d
│   │   │   ├── bonita-tenant-sp-custom.xml
│   │   │   ├── config-workers.sh
│   │   │   ├── event-handler-example-1.0.0-SNAPSHOT.jar
│   │   │   └── register-event-handler.sh
</code></pre></div></div>

<h3 id="dynamic-initialization-files">Dynamic initialization files</h3>

<p>Dynamic custom initialization files must be placed in BCD’s <code class="highlighter-rouge">roles/bonita/templates/custom-init.d</code> folder. All files with a <code class="highlighter-rouge">.j2</code> extension will be uploaded to the target host and stripped from the <code class="highlighter-rouge">.j2</code> suffix. However only the files with a <code class="highlighter-rouge">.sh.j2</code> extension will be executed.</p>

<p>Here’s the directory layout for the provided <code class="highlighter-rouge">config-cluster.sh.j2</code> initialization script:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roles
├── bonita
│   └── templates
│       └── custom-init.d
│           ├── bonita-platform-sp-cluster-custom.properties.j2
│           ├── config-cluster.sh.j2
</code></pre></div></div>

<h2 id="when-are-custom-initialization-scripts-invoked">When are custom initialization scripts invoked?</h2>

<p>Custom initialization scripts are invoked once the database has been initialized and the Tomcat server has been configured with <a href="https://documentation.bonitasoft.com/bonita/${bonitaDocVersion}/BonitaBPM_platform_setup">Bonita Platform setup tool</a>.</p>

<p>Hence the Bonita Docker image startup sequence can be described as follows:</p>

<ol>
  <li>Initialize database: <code class="highlighter-rouge">setup.sh init</code></li>
  <li>Configure Tomcat server: <code class="highlighter-rouge">setup.sh configure</code></li>
  <li>Execute custom initialization <code class="highlighter-rouge">*.sh</code> scripts found in the container’s <code class="highlighter-rouge">/opt/custom-init.d</code> folder</li>
  <li>Start Tomcat server</li>
</ol>

<div class="alert alert-info">
<p><strong>Warning</strong>: all custom scripts are re-executed each time the Bonita Docker container is restarted.</p>

<p>If you want your script to be executed only once, you need to handle the conditional execution in your custom script itself.
For example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">indicator_path</span><span class="o">=</span>/opt/<span class="k">$(</span><span class="nb">basename</span> <span class="nv">$BASH_ARGV</span><span class="k">)</span><span class="nt">-executed</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Custom script already executed"</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
<span class="k">fi</span>

<span class="c">#</span>
<span class="c"># Do some interesting stuff</span>
<span class="c"># [...]</span>

<span class="c"># Create indicator file</span>
<span class="nb">touch</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span>
</code></pre></div></div>
</div>

<h2 id="in-which-order-are-custom-initialization-scripts-invoked">In which order are custom initialization scripts invoked?</h2>

<p>Custom scripts are executed in natural sort order as implemented by the <code class="highlighter-rouge">ls</code> shell command. It is also referred as <em>natural sort of (version) numbers within text</em>.</p>

<p>More precisely scripts are executed in the order returned by this command: <code class="highlighter-rouge">ls -v /opt/custom-init.d/*.sh</code>.</p>

<h2 id="examples">Examples</h2>

<h3 id="1-config-workerssh">1. config-workers.sh</h3>

<p>The <code class="highlighter-rouge">config-workers.sh</code> script is provided as part of BCD’s core scripts.
In particular it shows how to further configure the server using <a href="https://documentation.bonitasoft.com/bonita/${bonitaDocVersion}/BonitaBPM_platform_setup">Bonita Platform setup tool</a>.</p>

<h3 id="2-config-clustershj2">2. config-cluster.sh.j2</h3>

<p>The <code class="highlighter-rouge">config-cluster.sh.j2</code> script template is provided as part of BCD’s core scripts.
In particular it shows how to conditionally configure a cluster deployment on AWS using BCD variables and <a href="http://docs.ansible.com/ansible/latest/playbooks_templating.html">Jinja2 templating engine</a>.</p>

<h3 id="3-register-event-handlersh">3. register-event-handler.sh</h3>

<p>This sample script deploys and registers a Bonita engine Event handler as described in <a href="https://documentation.bonitasoft.com/bonita/${bonitaDocVersion}/event-handlers">Event handlers Documentation</a>.</p>

<p>Assuming the following files:</p>

<ul>
  <li><code class="highlighter-rouge">roles/bonita/files/custom-init.d/event-handler-example-1.0.0-SNAPSHOT.jar</code> (event handler JAR file)</li>
  <li><code class="highlighter-rouge">roles/bonita/files/custom-init.d/bonita-tenant-sp-custom.xml</code> (tenant configuration file where the event handler is registered)</li>
</ul>

<p>Here’s a sample <code class="highlighter-rouge">register-event-handler.sh</code> script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nb">set</span> <span class="nt">-euxo</span> pipefail

<span class="nv">indicator_path</span><span class="o">=</span>/opt/<span class="k">$(</span><span class="nb">basename</span> <span class="nv">$BASH_ARGV</span><span class="k">)</span><span class="nt">-executed</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Custom script already executed"</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
<span class="k">fi

</span><span class="nv">BONITA_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">:-</span><span class="p">/opt/bonita</span><span class="k">}</span>
<span class="nv">BONITA_FILES</span><span class="o">=</span><span class="k">${</span><span class="nv">BONITA_FILES</span><span class="k">:-</span><span class="p">/opt/files</span><span class="k">}</span>
<span class="nv">BONITA_SETUP_SH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">}</span><span class="s2">/Bonita*Subscription-</span><span class="k">${</span><span class="nv">BONITA_VERSION</span><span class="k">}</span><span class="s2">-Tomcat-</span><span class="k">${</span><span class="nv">TOMCAT_VERSION</span><span class="k">}</span><span class="s2">/setup/setup.sh"</span>

<span class="nv">EVENT_HANDLER_FILENAME</span><span class="o">=</span>event-handler-example-1.0.0-SNAPSHOT.jar


<span class="nv">war_path</span><span class="o">=</span><span class="k">$(</span>find <span class="s2">"</span><span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">}</span><span class="s2">/Bonita"</span><span class="k">*</span><span class="s2">"Subscription-</span><span class="k">${</span><span class="nv">BONITA_VERSION</span><span class="k">}</span><span class="s2">-Tomcat-</span><span class="k">${</span><span class="nv">TOMCAT_VERSION</span><span class="k">}</span><span class="s2">/server/webapps"</span> <span class="nt">-name</span> bonita.war<span class="k">)</span>
<span class="nv">script_dir</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">cd</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="k">)</span><span class="s2">"</span>
<span class="nv">workdir</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">BONITA_FILES</span><span class="k">}</span><span class="s2">/register-event-handler"</span>
<span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">${</span><span class="nv">workdir</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">workdir</span><span class="k">}</span>

<span class="nb">pushd</span> <span class="k">${</span><span class="nv">workdir</span><span class="k">}</span>

<span class="c"># copy event handler jar</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> WEB-INF/lib
<span class="nb">cp</span> <span class="k">${</span><span class="nv">script_dir</span><span class="k">}</span>/<span class="k">${</span><span class="nv">EVENT_HANDLER_FILENAME</span><span class="k">}</span> WEB-INF/lib/

<span class="c"># repackage war</span>
zip <span class="nt">-r</span> <span class="s2">"</span><span class="k">${</span><span class="nv">war_path</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"WEB-INF/lib/</span><span class="k">${</span><span class="nv">EVENT_HANDLER_FILENAME</span><span class="k">}</span><span class="s2">"</span>


<span class="c"># register event handler</span>
<span class="k">${</span><span class="nv">BONITA_SETUP_SH</span><span class="k">}</span> pull
<span class="nb">cp</span> /opt/custom-init.d/bonita-tenant-sp-custom.xml <span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">}</span>/Bonita<span class="k">*</span>Subscription-<span class="k">${</span><span class="nv">BONITA_VERSION</span><span class="k">}</span><span class="nt">-Tomcat-</span><span class="k">${</span><span class="nv">TOMCAT_VERSION</span><span class="k">}</span>/setup/platform_conf/current/tenant_template_engine/
<span class="k">${</span><span class="nv">BONITA_SETUP_SH</span><span class="k">}</span> push

<span class="c"># Create indicator file</span>
<span class="nb">touch</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span>
</code></pre></div></div>

<h3 id="4-deploy-probesh">4. deploy-probe.sh</h3>

<p>This sample script deploys <a href="https://github.com/psi-probe/psi-probe/wiki">PSI Probe</a> (an <em>Advanced manager and monitor for Apache Tomcat</em>) along with Bonita in the Tomcat bundle.</p>

<p>In particular, it shows how to reference BCD variables in custom initialization files. All custom referenced variables can be defined at <a href="/bcd/1.0/scenarios">BCD scenario</a> level.</p>

<p>With this example, PSI Probe will be available at this URL: <code class="highlighter-rouge">http://&lt;bonita_host&gt;:8081/probe</code>. To connect to PSI Probe, use the credentials defined with the <code class="highlighter-rouge">custom_manager_username</code> and <code class="highlighter-rouge">custom_manager_password</code> variables. By default: <code class="highlighter-rouge">custom_manager_username=admin</code> and <code class="highlighter-rouge">custom_manager_password=t0psecret</code>.</p>

<h4 id="deploy-probeshj2">deploy-probe.sh.j2</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nb">set</span> <span class="nt">-euxo</span> pipefail

<span class="nv">indicator_path</span><span class="o">=</span>/opt/<span class="k">$(</span><span class="nb">basename</span> <span class="nv">$BASH_ARGV</span><span class="k">)</span><span class="nt">-executed</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Custom script already executed"</span> <span class="o">&amp;&amp;</span> <span class="k">return </span>0
<span class="k">fi


</span><span class="nv">BONITA_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">:-</span><span class="p">/opt/bonita</span><span class="k">}</span>
<span class="nv">script_dir</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">cd</span> <span class="s2">"</span><span class="k">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="k">)</span><span class="s2">"</span>

<span class="nb">pushd</span> <span class="k">${</span><span class="nv">BONITA_PATH</span><span class="k">}</span>/Bonita<span class="k">*</span>Subscription-<span class="k">${</span><span class="nv">BONITA_VERSION</span><span class="k">}</span><span class="nt">-Tomcat-</span><span class="k">${</span><span class="nv">TOMCAT_VERSION</span><span class="k">}</span>

<span class="c"># Allow Tomcat Manager from different host</span>
<span class="nb">cp</span> <span class="k">${</span><span class="nv">script_dir</span><span class="k">}</span>/manager-context.xml server/conf/Catalina/localhost/manager.xml

<span class="c"># PSI Probe</span>
curl <span class="nt">-sSL</span> <span class="nt">-o</span> server/webapps/probe.war https://github.com/psi-probe/psi-probe/releases/download//probe.war
<span class="nb">cp</span> <span class="k">${</span><span class="nv">script_dir</span><span class="k">}</span>/tomcat-users.xml server/conf/tomcat-users.xml

<span class="c"># Create indicator file</span>
<span class="nb">touch</span> <span class="k">${</span><span class="nv">indicator_path</span><span class="k">}</span>
</code></pre></div></div>

<h4 id="manager-contextxmlj2">manager-context.xml.j2</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;Context</span> <span class="na">antiResourceLocking=</span><span class="s">"false"</span> <span class="na">privileged=</span><span class="s">"true"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">"org.apache.catalina.valves.RemoteAddrValve"</span> <span class="na">allow=</span><span class="s">""</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Manager</span> <span class="na">sessionAttributeValueClassNameFilter=</span><span class="s">"java\.lang\.(?:Boolean|Integer|Long|Number|String)|org\.apache\.catalina\.filters\.CsrfPreventionFilter\$LruCache(?:\$1)?|java\.util\.(?:Linked)?HashMap"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Context&gt;</span>
</code></pre></div></div>

<h4 id="tomcat-usersxmlj2">tomcat-users.xml.j2</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;tomcat-users</span> <span class="na">xmlns=</span><span class="s">"http://tomcat.apache.org/xml"</span>
              <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
              <span class="na">xsi:schemaLocation=</span><span class="s">"http://tomcat.apache.org/xml tomcat-users.xsd"</span>
              <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"probeuser"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"poweruser"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"poweruserplus"</span> <span class="nt">/&gt;</span>
  
  <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"manager-gui"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">""</span> <span class="na">password=</span><span class="s">""</span> <span class="na">roles=</span><span class="s">"manager-gui"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/tomcat-users&gt;</span>
</code></pre></div></div>

<h3 id="5-more-examples-about-rest-api-authorization">5. More examples about REST API authorization</h3>

<p>See <a href="/bcd/1.0/tutorials/bonita-container-custom-initialization/how_to_configure_rest_api_authorization">how to configure REST API authorization</a>.</p>

                    </div>
                </div>
            
            </div>
        </div>
    </div>
    <!-- scripts --><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
    <script src="/assets/javascripts/active_link.js"></script>

    <script src="/assets/javascripts/collapse.js"></script></body>
</html>